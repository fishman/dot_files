<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- Created by htmlize-1.34 in css mode. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <title>prompt_manoj_setup</title>
    <link href="mailto:srivasta@debian.org" rev="made" />
    <style type="text/css">
    <!--
      body {
        color: #f5f5f5;
        background-color: #000000;
      }
      .builtin {
        /* font-lock-builtin-face */
        color: #b0c4de;
      }
      .comment {
        /* font-lock-comment-face */
        color: #ff7f24;
        font-style: italic;
      }
      .comment-delimiter {
        /* font-lock-comment-delimiter-face */
        color: #fa8072;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #00fa9a;
        font-size: 110%;
        font-weight: bold;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #00ffff;
      }
      .negation-char {
      }
      .sh-escaped-newline {
        /* sh-escaped-newline */
        color: #ffc1c1;
      }
      .sh-heredoc {
        /* sh-heredoc */
        color: #ffff00;
        font-weight: bold;
      }
      .string {
        /* font-lock-string-face */
        color: #ffc1c1;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #7fffd4;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
<span class="comment-delimiter">#</span><span class="comment">! /bin/</span><span class="keyword">zsh</span><span class="comment"> -f
</span><span class="comment-delimiter">#                               </span><span class="comment">-*- Mode: Sh -*- 
</span><span class="comment-delimiter"># </span><span class="comment">prompt_manoj_setup --- 
</span><span class="comment-delimiter"># </span><span class="comment">Author           : Manoj Srivastava ( srivasta@glaurung.internal.golden-gryphon.com ) 
</span><span class="comment-delimiter"># </span><span class="comment">Created On       : Thu Jul 28 12:53:34 2005
</span><span class="comment-delimiter"># </span><span class="comment">Created On Node  : glaurung.internal.golden-gryphon.com
</span><span class="comment-delimiter"># </span><span class="comment">Last Modified By : Manoj Srivastava
</span><span class="comment-delimiter"># </span><span class="comment">Last Modified On : Tue May 27 21:03:55 2008
</span><span class="comment-delimiter"># </span><span class="comment">Last Machine Used: anzu.internal.golden-gryphon.com
</span><span class="comment-delimiter"># </span><span class="comment">Update Count     : 207
</span><span class="comment-delimiter"># </span><span class="comment">Status           : Unknown, Use with caution!
</span><span class="comment-delimiter"># </span><span class="comment">HISTORY          : 
</span><span class="comment-delimiter"># </span><span class="comment">Description      : 
</span><span class="comment-delimiter"># </span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">Copyright &#169; 2008 Manoj Srivastava &lt;srivasta@debian.org
</span><span class="comment-delimiter"># </span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">This file is free software: you can redistribute it and/or modify
</span><span class="comment-delimiter"># </span><span class="comment">it under the terms of the GNU General Public License as published by
</span><span class="comment-delimiter"># </span><span class="comment">the Free Software Foundation, either version 3 of the License, or
</span><span class="comment-delimiter"># </span><span class="comment">(at your option) any later version.
</span><span class="comment-delimiter">#</span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">GNU Emacs is distributed in the hope that it will be useful,
</span><span class="comment-delimiter"># </span><span class="comment">but WITHOUT ANY WARRANTY; without even the implied warranty of
</span><span class="comment-delimiter"># </span><span class="comment">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
</span><span class="comment-delimiter"># </span><span class="comment">GNU General Public License for more details.
</span><span class="comment-delimiter">#</span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">On Debian GNU/Linux systems, the complete text of the GNU General
</span><span class="comment-delimiter"># </span><span class="comment">Public License can be found in `/usr/share/common-licenses/GPL'
</span><span class="comment-delimiter">#</span><span class="comment">
</span><span class="comment-delimiter">#    </span><span class="comment">A copy of the GNU General Public License is also available at
</span><span class="comment-delimiter">#    </span><span class="comment">&lt;<a href="http://www.gnu.org/copyleft/gpl.html">URL:http://www.gnu.org/copyleft/gpl.html</a>&gt;.  You may also obtain
</span><span class="comment-delimiter">#    </span><span class="comment">it by writing to the Free Software Foundation, Inc., 51 Franklin
</span><span class="comment-delimiter">#    </span><span class="comment">St, Fifth Floor, Boston, MA 02110-1301 USA
</span><span class="comment-delimiter"># </span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment"> You can download the file <a href="/software/misc/prompt_manoj_setup">here</a>
</span><span class="comment-delimiter"># </span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">
</span><span class="comment-delimiter"># </span><span class="comment">
</span>
<span class="function-name">prompt_manoj_help</span> () {
  cat &lt;&lt;<span class="string">'EOF'</span><span class="sh-heredoc">
This prompt is not really color themable, I just use this in case I
ever decide to go the angry fruit salad route. This is also unlikely
to be a prompt that is very interesting; interesting prompts are, to
me, a distraction.

What I need from a prompt is simplicity; and the information that is
useful is user name, host, and path of the current directory, in a
title in the xterm, or s shortish string in a console.

Colors are present for the case of a laptop, then, if the battery is
discharging, then the prompt color should change with the state of the
battery.

EOF
</span>}

<span class="comment-delimiter">## </span><span class="comment">don't ask me 'do you wish to see all XX possibilities' before menu selection
</span><span class="variable-name">LISTPROMPT</span>=<span class="string">''</span>

<span class="comment-delimiter">## </span><span class="comment">SPROMPT - the spelling prompt
</span><span class="variable-name">SPROMPT</span>=<span class="string">'zsh: correct '</span>%R<span class="string">' to '</span>%r<span class="string">' ? ([Y]es/[N]o/[E]dit/[A]bort) '</span>


<span class="builtin">typeset</span> -Ag ansi_colors other_colors term_color_fg term_color_bg 

<span class="comment-delimiter"># </span><span class="comment">The problem with colors in terminal emulators is that there are two
</span><span class="comment-delimiter"># </span><span class="comment">distinct mechanisms for color: the first one is the Tektronics or
</span><span class="comment-delimiter"># </span><span class="comment">ANSI termminals, which use the command sequece defined in the
</span><span class="comment-delimiter"># </span><span class="comment">terminfo capability setaf/setab pairs, and have one mappping from
</span><span class="comment-delimiter"># </span><span class="comment">colors to color indexes, like so:
</span><span class="variable-name">ansi_colors</span>=(
    black     0                yellow    3                cyan      6
    red       1                blue      4                white     7
    green     2                magenta   5
)
<span class="comment-delimiter"># </span><span class="comment">However, there may exist other terminals which are not ANSI
</span><span class="comment-delimiter"># </span><span class="comment">terminals (SYVR4?), and these use the capability sets setf/setb, and
</span><span class="comment-delimiter"># </span><span class="comment">a different color index mapping -- like so.
</span><span class="variable-name">other_colors</span>=(
    black     0                cyan      3                yellow    6
    blue      1                red       4                white     7
    green     2                magenta   5 
)

<span class="comment-delimiter"># </span><span class="comment">I use the following Xresources, which go better with my dark xterms
</span><span class="comment-delimiter">## </span><span class="comment">*VT100*color0:  black                                         
</span><span class="comment-delimiter">## </span><span class="comment">*VT100*color1:  rgb:FF/33/33    !red                          
</span><span class="comment-delimiter">## </span><span class="comment">*VT100*color2:  rgb:66/FF/33    !green                        
</span><span class="comment-delimiter">## </span><span class="comment">*VT100*color3:  rgb:FF/EB/33    !yellow                       
</span><span class="comment-delimiter">## </span><span class="comment">*VT100*color4:  rgb:33/A3/FF    !blue                         
</span><span class="comment-delimiter">## </span><span class="comment">*VT100*color5:  rgb:70/33/FF    !magenta                      
</span><span class="comment-delimiter">## </span><span class="comment">*VT100*color6:  rgb:33/FF/AD    !cyan                         
</span><span class="comment-delimiter">## </span><span class="comment">*VT100*color7:  cornsilk        !white rgb:FF/33/E0  violet   
</span><span class="comment-delimiter">## </span><span class="comment">*VT100*color8:  DarkSlateGrey                                 
</span><span class="comment-delimiter">## </span><span class="comment">*VT100*color9:  rgb:FF/99/99    !light red                    
</span><span class="comment-delimiter">## </span><span class="comment">*VT100*color10: rgb:B3/FF/99    !light green                  
</span><span class="comment-delimiter">## </span><span class="comment">*VT100*color11: rgb:FF/F5/99    !light yellow                 
</span><span class="comment-delimiter">## </span><span class="comment">*VT100*color12: rgb:99/D1/FF    !light blue                   
</span><span class="comment-delimiter">## </span><span class="comment">*VT100*color13: rgb:B8/99/FF    !light magenta                
</span><span class="comment-delimiter">## </span><span class="comment">*VT100*color14: rgb:99/FF/D6    !light cyan                   
</span><span class="comment-delimiter">## </span><span class="comment">*VT100*color15: rgb:FF/99/F0    !light violet                 
</span>
<span class="comment-delimiter"># </span><span class="comment">Since there are distinct command to set up a foreground color versus
</span><span class="comment-delimiter"># </span><span class="comment">a back ground color, and the command pairs depend on whether or not
</span><span class="comment-delimiter"># </span><span class="comment">the terminal is an ANSI terminal or not, it is convenient to set up
</span><span class="comment-delimiter"># </span><span class="comment">the fore ground and back gorund color arrays ahead of time. The
</span><span class="comment-delimiter"># </span><span class="comment">following set of associative arrays is what the ZSH built in color
</span><span class="comment-delimiter"># </span><span class="comment">associative array should have been, if it wants to be somewhat
</span><span class="comment-delimiter"># </span><span class="comment">portable
</span>
<span class="comment-delimiter"># </span><span class="comment">Set up fore ground and background, using the appropriate functions,
</span><span class="comment-delimiter"># </span><span class="comment">based on the type of terminal we have.
</span><span class="keyword">if</span>   [[ -n <span class="string">"$terminfo[setaf]"</span> ]]; <span class="keyword">then</span>
    <span class="keyword">for</span> k<span class="keyword"> in</span> ${(k)ansi_colors}; <span class="keyword">do</span>
        <span class="variable-name">term_color_fg</span>[$<span class="variable-name">k</span>]=$(echoti setaf $<span class="variable-name">ansi_colors</span>[$<span class="variable-name">k</span>])
        <span class="variable-name">term_color_bg</span>[$<span class="variable-name">k</span>]=$(echoti setab $<span class="variable-name">ansi_colors</span>[$<span class="variable-name">k</span>])
    <span class="keyword">done</span>
<span class="keyword">elif</span> [[ -n <span class="string">"$terminfo[setf]"</span>  ]]; <span class="keyword">then</span>
    <span class="keyword">for</span> k<span class="keyword"> in</span> ${(k)ansi_colors}; <span class="keyword">do</span>
        <span class="variable-name">term_color_fg</span>[$<span class="variable-name">k</span>]=$(echoti setf $<span class="variable-name">other_colors</span>[$<span class="variable-name">k</span>])
        <span class="variable-name">term_color_bg</span>[$<span class="variable-name">k</span>]=$(echoti setb $<span class="variable-name">other_colors</span>[$<span class="variable-name">k</span>])
    <span class="keyword">done</span>
<span class="keyword">else</span>
    <span class="keyword">for</span> k<span class="keyword"> in</span> ${(k)ansi_colors}; <span class="keyword">do</span>
        <span class="variable-name">term_color_fg</span>[$<span class="variable-name">k</span>]=
        <span class="variable-name">term_color_bg</span>[$<span class="variable-name">k</span>]=
    <span class="keyword">done</span>
<span class="keyword">fi</span>

<span class="comment-delimiter"># </span><span class="comment">Set the color of the prompt based on battery levels. Again, we try
</span><span class="comment-delimiter"># </span><span class="comment">to cater to both the older APM based power schemas, and the new ACPI
</span><span class="comment-delimiter"># </span><span class="comment">stuff. First let us do APM:
</span><span class="variable-name">APM</span>=<span class="string">"/usr/bin/apm"</span>

<span class="comment-delimiter"># </span><span class="comment">Determine battery level as a percentage
</span><span class="function-name">prompt_manoj_apm_percent</span> () {
    <span class="variable-name">state_line</span>=$($<span class="variable-name">APM</span>)
    <span class="variable-name">cut_leading</span>=${<span class="variable-name">state_line</span>#*: }
    <span class="variable-name">APM_PERCENT</span>=${<span class="variable-name">cut_leading</span>%%%*}
    <span class="builtin">echo</span> $<span class="variable-name">APM_PERCENT</span>
}

<span class="comment-delimiter"># </span><span class="comment">Are we charging, or discharging?
</span><span class="function-name">prompt_manoj_apm_charge</span> () {
    <span class="keyword">case</span> <span class="string">"$($APM)"</span><span class="keyword"> in</span>
        *on-line*)
            <span class="variable-name">APM_CHARGE</span>=<span class="string">"+"</span> ;;
        *off-line*)
            <span class="variable-name">APM_CHARGE</span>=<span class="string">"-"</span> ;;
    <span class="keyword">esac</span>
    <span class="builtin">echo</span> $<span class="variable-name">APM_CHARGE</span>
}

<span class="comment-delimiter"># </span><span class="comment">Mostly for debugging
</span><span class="function-name">prompt_manoj_echo_apm</span> () {
    <span class="builtin">echo</span> -n <span class="string">"($(prompt_manoj_apm_charge)$(prompt_manoj_apm_percent)) "</span>
}

<span class="comment-delimiter"># </span><span class="comment">Set the prompt based on the percentage of battery liefe
</span><span class="comment-delimiter"># </span><span class="comment">remaining. What part of the prompt is colored is determmined later,
</span><span class="comment-delimiter"># </span><span class="comment">and depends on the terminal type.
</span><span class="function-name">prompt_manoj_apm_color</span> () {
    <span class="keyword">if</span>  [  <span class="string">"$(prompt_manoj_apm_charge)"</span>  =  <span class="string">"+"</span>  ];  <span class="keyword">then</span>
        <span class="builtin">echo</span>  <span class="string">"B%$term_color_fg[cyan]"</span>
    <span class="keyword">else</span>
        <span class="keyword">case</span>  $(prompt_manoj_apm_percent)  <span class="keyword">in</span>
            10?) <span class="builtin">echo</span>  <span class="string">"$term_color_fg[white]%B"</span>  ;;
            9?)  <span class="builtin">echo</span>  <span class="string">"$term_color_fg[green]"</span>  ;;
            8?)  <span class="builtin">echo</span>  <span class="string">"$term_color_fg[green]"</span>  ;;
            7?)  <span class="builtin">echo</span>  <span class="string">"$term_color_fg[green]"</span>  ;;
            6?)  <span class="builtin">echo</span>  <span class="string">"$term_color_fg[blue]"</span>  ;;
            5?)  <span class="builtin">echo</span>  <span class="string">"$term_color_fg[blue]"</span>  ;;
            4?)  <span class="builtin">echo</span>  <span class="string">"$term_color_fg[blue]"</span>  ;;
            3?)  <span class="builtin">echo</span>  <span class="string">"$term_color_fg[yellow]%B"</span>  ;;
            2?)  <span class="builtin">echo</span>  <span class="string">"$term_color_fg[yellow]%B"</span>  ;;
            1?)  <span class="builtin">echo</span>  <span class="string">"$term_color_fg[red]"</span>  ;;
            ?)   <span class="builtin">echo</span>  <span class="string">"$term_color_fg[red]%B${terminfo[blink]}"</span>  ;;
            *)   <span class="builtin">echo</span>  <span class="string">"$term_color_fg[magenta]"</span>  ;;
        <span class="keyword">esac</span>
    <span class="keyword">fi</span>
}

<span class="comment-delimiter">#  </span><span class="comment">Now let us do the same thing for ACPI. Calculation of the
</span><span class="comment-delimiter">#  </span><span class="comment">percentage of battery power remaining is more complex, since ACPI
</span><span class="comment-delimiter">#  </span><span class="comment">reports in finer granularity; We need to look for the power levels
</span><span class="comment-delimiter">#  </span><span class="comment">for each battery, of which there can be more than one. Also, just
</span><span class="comment-delimiter">#  </span><span class="comment">because a battery interface (the BAT? directories) exists does not
</span><span class="comment-delimiter">#  </span><span class="comment">mean there is a battery currently in the slot. Also, when the
</span><span class="comment-delimiter">#  </span><span class="comment">machine is on AC power, the remaining capacity is meanigless; it is
</span><span class="comment-delimiter">#  </span><span class="comment">set to the full design capability, long after the battery is unable
</span><span class="comment-delimiter">#  </span><span class="comment">to charge to those levels.
</span>
<span class="comment-delimiter"># </span><span class="comment">So, we accumulate the current remaingin power, and the last full
</span><span class="comment-delimiter"># </span><span class="comment">charge, since that is more meaningful than the designed capacity,
</span><span class="comment-delimiter"># </span><span class="comment">which my batteries have failed to reach for years now. I have
</span><span class="comment-delimiter"># </span><span class="comment">commented out the designed capacity bit, since it is mostly useless,
</span><span class="comment-delimiter"># </span><span class="comment">and just slows things down.
</span><span class="function-name">prompt_manoj_acpi_percentage</span> () {
    <span class="builtin">local</span> designed last_full current d l c percent
    <span class="comment-delimiter">#</span><span class="comment">designed=0
</span>    <span class="variable-name">last_full</span>=0
    <span class="variable-name">current</span>=0
    <span class="keyword">for</span> battery<span class="keyword"> in</span> /proc/acpi/battery/BAT?; <span class="keyword">do</span>
        <span class="comment-delimiter">#</span><span class="comment">d=$(egrep '^design capacity:' $battery/info 2&gt;/dev/null | \
</span>        <span class="comment-delimiter">#    </span><span class="comment">sed -e 's/^design capacity: *//' -e 's/ *mWh.*$//')
</span>        <span class="variable-name">l</span>=$(egrep <span class="string">'^last full capacity:'</span> $<span class="variable-name">battery</span>/info 2&gt;/dev/null | <span class="sh-escaped-newline">\</span>
            sed -e <span class="string">'s/^last full capacity: *//'</span> -e <span class="string">'s/ *mAh.*$//'</span>)
        <span class="variable-name">c</span>=$(egrep <span class="string">'^remaining capacity:'</span> $<span class="variable-name">battery</span>/state 2&gt;/dev/null | <span class="sh-escaped-newline">\</span>
            sed -e <span class="string">'s/^remaining capacity: *//'</span> -e <span class="string">'s/ *mAh.*$//'</span>)
        <span class="comment-delimiter">#</span><span class="comment">(( designed  = designed  + d ))
</span>        (( <span class="variable-name">last_full</span> = last_full + l ))
        (( <span class="variable-name">current</span>   = current   + c ))
    <span class="keyword">done</span>
    <span class="variable-name">percent</span>=100
    <span class="keyword">if</span> [[ -n <span class="string">"$last_full"</span> &amp;&amp; $<span class="variable-name">last_full</span> -gt 0 ]]; <span class="keyword">then</span>
        <span class="keyword">if</span> [[ $<span class="variable-name">current</span> -lt $<span class="variable-name">last_full</span> ]]; <span class="keyword">then</span>
            ((<span class="variable-name">percent</span> = 100 * current / last_full ))
        <span class="keyword">fi</span>
    <span class="keyword">fi</span>
    <span class="builtin">echo</span> $<span class="variable-name">percent</span>
}
<span class="comment-delimiter"># </span><span class="comment">The top level function. Here, if we do not have a battery interface,
</span><span class="comment-delimiter"># </span><span class="comment">we just return the bland old white prompt. We do the same if the
</span><span class="comment-delimiter"># </span><span class="comment">laptop is fully charged. If the laptop is currently charging, we
</span><span class="comment-delimiter"># </span><span class="comment">just return cyan; and do not bother with the slowish percentage
</span><span class="comment-delimiter"># </span><span class="comment">calculation. When the batteries are discharging, we slowly change
</span><span class="comment-delimiter"># </span><span class="comment">the prompt color from white to red; blinking the prompt just before
</span><span class="comment-delimiter"># </span><span class="comment">the battery dies.
</span><span class="function-name">prompt_manoj_acpi_color</span> () {
    <span class="keyword">if</span> [[ <span class="negation-char">!</span> -e /proc/acpi/battery/BAT0 ]]; <span class="keyword">then</span>
        <span class="builtin">echo</span>  <span class="string">"%B$term_color_fg[green]"</span>
        <span class="keyword">return</span>
    <span class="keyword">fi</span>
    <span class="builtin">local</span> state
    <span class="variable-name">result</span>=
    <span class="keyword">for</span> battery<span class="keyword"> in</span> /proc/acpi/battery/BAT?; <span class="keyword">do</span>
        <span class="variable-name">state</span>=$(egrep <span class="string">'^charging state:'</span> $<span class="variable-name">battery</span>/state | sed -e <span class="string">'s/^charging state: *//'</span>)
        <span class="keyword">case</span> state<span class="keyword"> in</span>
            charged)
                <span class="variable-name">result</span>=${<span class="variable-name">result</span>:=charged}
                ;;
            discharging)
                <span class="variable-name">result</span>=discharging
                ;;
            charging)
                <span class="variable-name">result</span>=charging
                ;;
            *)
                <span class="comment-delimiter"># </span><span class="comment">do nothing
</span>        <span class="keyword">esac</span>
    <span class="keyword">done</span>
    <span class="keyword">if</span> [[ <span class="string">"$result"</span> == <span class="string">"charged"</span> ]]; <span class="keyword">then</span>
        <span class="builtin">echo</span> -n  <span class="string">"%B$term_color_fg[white]"</span>
        <span class="keyword">return</span>
    <span class="keyword">elif</span> [[ <span class="string">"$result"</span> == <span class="string">"charging"</span> ]]; <span class="keyword">then</span>
        <span class="builtin">echo</span> -n  <span class="string">"B%$term_color_fg[cyan]"</span>
        <span class="keyword">return</span>
    <span class="keyword">fi</span>
    <span class="keyword">case</span>  $(prompt_manoj_acpi_percentage)  <span class="keyword">in</span>
        10?) <span class="builtin">echo</span> -n  <span class="string">"%B$term_color_fg[white]"</span>  ;;
        9?)  <span class="builtin">echo</span> -n  <span class="string">"$term_color_fg[green]"</span>  ;;
        8?)  <span class="builtin">echo</span> -n  <span class="string">"$term_color_fg[green]"</span>  ;;
        7?)  <span class="builtin">echo</span> -n  <span class="string">"$term_color_fg[green]"</span>  ;;
        6?)  <span class="builtin">echo</span> -n  <span class="string">"$term_color_fg[blue]"</span>  ;;
        5?)  <span class="builtin">echo</span> -n  <span class="string">"$term_color_fg[blue]"</span>  ;;
        4?)  <span class="builtin">echo</span> -n  <span class="string">"$term_color_fg[blue]"</span>  ;;
        3?)  <span class="builtin">echo</span> -n  <span class="string">"%B$term_color_fg[yellow]"</span>  ;;
        2?)  <span class="builtin">echo</span> -n  <span class="string">"%B$term_color_fg[yellow]"</span>  ;;
        1?)  <span class="builtin">echo</span> -n  <span class="string">"$term_color_fg[red]"</span>  ;;
        ?)   <span class="builtin">echo</span> -n  <span class="string">"%B${terminfo[blink]}$term_color_fg[red]"</span>  ;;
        *)   <span class="builtin">echo</span> -n  <span class="string">"$term_color_fg[magenta]"</span>  ;;
    <span class="keyword">esac</span>
}

<span class="comment-delimiter"># </span><span class="comment">When we change the directory, we set the title of the xterm if we
</span><span class="comment-delimiter"># </span><span class="comment">are on an xterm, or else we massage the workdir variable. Note that
</span><span class="comment-delimiter"># </span><span class="comment">we need to runcate less in an xterm title than we do on a console
</span><span class="comment-delimiter"># </span><span class="comment">prompt (since the latter uses up line real estate))
</span><span class="function-name">prompt_manoj_chpwd</span> () {
    <span class="builtin">setopt</span> noxtrace localoptions
    <span class="keyword">if</span> [ <span class="string">"$TERM"</span> = <span class="string">"xterm"</span> ] || [ <span class="string">"$TERM"</span> = <span class="string">"xterm-debian"</span> ] || 
        [ <span class="string">"$TERM"</span> = <span class="string">"Eterm"</span> ] || [ <span class="string">"$TERM"</span> = <span class="string">"xterm-256color"</span> ]; <span class="keyword">then</span>
        <span class="variable-name">workdir</span>=$(<span class="builtin">print</span> -P <span class="string">'%30&lt;&lt;%~'</span>)
        <span class="keyword">if</span> [[ $<span class="variable-name">#</span>workdir -gt 25 ]]; <span class="keyword">then</span>
            <span class="variable-name">workdir</span>=${<span class="variable-name">workdir</span>/[^<span class="string">\/</span>]#/...}
        <span class="keyword">fi</span>
            <span class="comment-delimiter">#</span><span class="comment">perl -e 'printf "%c]2;%s%c", 27, "'$psvar[1]$workdir'", 7 ; '
</span>        <span class="keyword">case</span> $<span class="variable-name">TERM</span><span class="keyword"> in</span>
            sun-cmd)
                <span class="comment-delimiter">#</span><span class="comment">SETTERMTITLE=$(print -n "\e]l$psvar[1]$workdir\e\\")
</span>                <span class="builtin">print</span> -n <span class="string">"\e]l$psvar[4]$workdir\e\\"</span>
                ;;
            screen)
                <span class="builtin">print</span> -n <span class="string">"\ek"</span>$<span class="variable-name">psvar</span>[4]$<span class="variable-name">workdir</span><span class="string">"\e"\\\ </span>;
                ;;

            *xterm*|rxvt|(dt|k|E|x)term)
                <span class="builtin">print</span> -n <span class="string">"\e]2;$psvar[4]$workdir\a"</span>
                ;;
            *)
            :
            <span class="keyword">esac</span> 
   <span class="keyword">else</span>
     <span class="variable-name">workdir</span>=$(<span class="builtin">print</span> -P <span class="string">'%20&lt;&lt;%~'</span>)
     <span class="keyword">if</span> [[ $<span class="variable-name">#</span>workdir -gt 18 ]]; <span class="keyword">then</span>
         <span class="variable-name">workdir</span>=${<span class="variable-name">workdir</span>/[^<span class="string">\/</span>]#/...}
     <span class="keyword">fi</span>
     <span class="keyword">fi</span>
     <span class="keyword">if</span> command -v less &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span>
         ls -asCF --color=always | less -ELQ; <span class="comment-delimiter"># </span><span class="comment">I have a LESS setup elsewhere
</span>     <span class="keyword">else</span>
         ls -asCF | more -ds;
     <span class="keyword">fi</span>
}

<span class="comment-delimiter"># </span><span class="comment">Given a base directory as the first argument, use PWD o detemine
</span><span class="comment-delimiter"># </span><span class="comment">subdirectory of the repo root we are in.
</span><span class="function-name">__sub_dir</span>() {
    <span class="builtin">local</span> sub_dir
    <span class="variable-name">sub_dir</span>=$(readlink -f <span class="string">"${PWD}"</span>)
    <span class="variable-name">sub_dir</span>=${<span class="variable-name">sub_dir</span>#$<span class="variable-name">1</span>}
    <span class="builtin">echo</span> ${<span class="variable-name">sub_dir</span>#/}
}
<span class="comment-delimiter"># </span><span class="comment">In the following, set up the base_dir for the repository, the
</span><span class="comment-delimiter"># </span><span class="comment">sub_dir within that repository, the branch we are in, and if we are
</span><span class="comment-delimiter"># </span><span class="comment">in the middle of complex VCS operations.  Each functions sets these
</span><span class="comment-delimiter"># </span><span class="comment">variables for one kind of repository.
</span>
<span class="comment-delimiter"># </span><span class="comment">This is for arch
</span><span class="function-name">__arch_dir</span>() {
    <span class="variable-name">base_dir</span>=$(tla tree-root 2&gt;/dev/null) || <span class="keyword">return</span> 1
    <span class="variable-name">base_dir</span>=$(readlink -f <span class="string">"$base_dir"</span>)
    <span class="variable-name">sub_dir</span>=$(__sub_dir <span class="string">"${base_dir}"</span>)
    <span class="variable-name">branch</span>=$(tla tree-id)
    <span class="variable-name">branch</span>=${<span class="variable-name">branch</span>##[^/]*/}
    <span class="variable-name">vcs</span>=<span class="string">"arch"</span>
}

<span class="comment-delimiter"># </span><span class="comment">bzr
</span><span class="function-name">__bzr_dir</span>() {
    <span class="builtin">local</span> branch_nick revno
    <span class="variable-name">base_dir</span>=$(bzr info 2&gt;/dev/null) || <span class="keyword">return</span> 1
    <span class="variable-name">base_dir</span>=$(<span class="builtin">echo</span> <span class="string">"$base_dir"</span> | sed -rne <span class="string">'s, *branch root: ,,p'</span>)
    <span class="keyword">if</span> [[ <span class="string">"$base_dir"</span> == <span class="string">"."</span> ]]; <span class="keyword">then</span>
        <span class="variable-name">base_dir</span>=$<span class="variable-name">PWD</span>
    <span class="keyword">else</span>
        <span class="variable-name">base_dir</span>=$(readlink -f <span class="string">"$base_dir"</span>)
    <span class="keyword">fi</span>
    <span class="variable-name">sub_dir</span>=$(__sub_dir <span class="string">"${base_dir}"</span>)
    bzr version-info | <span class="keyword">while </span><span class="builtin">read</span> i j; <span class="keyword">do</span>
        <span class="keyword">case</span> <span class="string">"$i"</span><span class="keyword"> in</span>
            revno:) <span class="variable-name">revno</span>=<span class="string">"$j"</span>;;
            branch-nick:) <span class="variable-name">branch_nick</span>=<span class="string">"$j"</span>;;
        <span class="keyword">esac</span>
    <span class="keyword">done</span>
    <span class="variable-name">branch</span>=<span class="string">"bzr:${branch}@$revno"</span>
    <span class="variable-name">vcs</span>=bzr
}

<span class="comment-delimiter"># </span><span class="comment">git. 
</span><span class="function-name">__git_dir</span>() {
    <span class="variable-name">base_dir</span>=$(git-rev-parse --show-cdup 2&gt;/dev/null) || <span class="keyword">return</span> 1
    <span class="keyword">if</span> [[ -n <span class="string">"$base_dir"</span> ]]; <span class="keyword">then</span>
        <span class="variable-name">base_dir</span>=$(readlink -f <span class="string">"$base_dir"</span>)
    <span class="keyword">else</span>
        <span class="variable-name">base_dir</span>=$<span class="variable-name">PWD</span>
    <span class="keyword">fi</span>
    <span class="variable-name">sub_dir</span>=$(git-rev-parse --show-prefix)
    <span class="variable-name">sub_dir</span>=${<span class="variable-name">sub_dir</span>%/}
    <span class="variable-name">branch</span>=$(git-symbolic-ref -q HEAD || git-name-rev --name-only HEAD 2&gt;/dev/null)

    <span class="keyword">if</span> test -d <span class="string">"$base_dir/../.dotest"</span>; <span class="keyword">then</span>
        <span class="keyword">if</span> test -f <span class="string">"$base_dir/../.dotest/rebasing"</span>; <span class="keyword">then</span>
            <span class="variable-name">vcs_op</span>=<span class="string">"rebase"</span>
        <span class="keyword">elif</span> test -f <span class="string">"$base_dir/../.dotest/applying"</span>; <span class="keyword">then</span>
            <span class="variable-name">vcs_op</span>=<span class="string">"am"</span>
        <span class="keyword">else</span>
            <span class="variable-name">vcs_op</span>=<span class="string">"am/rebase"</span>
        <span class="keyword">fi</span>
    <span class="keyword">elif</span> test -f <span class="string">"$base_dir/.dotest-merge/interactive"</span>; <span class="keyword">then</span>
        <span class="variable-name">vcs_op</span>=<span class="string">"rebase -i"</span>
        <span class="variable-name">branch</span>=<span class="string">"$(cat "$base_dir/.dotest-merge/head-name")"</span>
    <span class="keyword">elif</span> test -d <span class="string">"$base_dir/.dotest-merge"</span>; <span class="keyword">then</span>
        <span class="variable-name">vcs_op</span>=<span class="string">"rebase -m"</span>
        <span class="variable-name">branch</span>=<span class="string">"$(cat "$base_dir/.dotest-merge/head-name")"</span>
    <span class="keyword">elif</span> test -f <span class="string">"$base_dir/MERGE_HEAD"</span>; <span class="keyword">then</span>
        <span class="variable-name">vcs_op</span>=<span class="string">"merge"</span>
    <span class="keyword">else</span>
        <span class="keyword">if</span> test -f <span class="string">"$base_dir/BISECT_LOG"</span>; <span class="keyword">then</span>
            <span class="variable-name">vcs_op</span>=<span class="string">"bisect"</span>
            <span class="variable-name">branch</span>=<span class="string">"$(git symbolic-ref HEAD 2&gt;/dev/null)"</span> || <span class="sh-escaped-newline">\</span>
                <span class="variable-name">branch</span>=<span class="string">"$(git describe --exact-match HEAD 2&gt;/dev/null)"</span> || <span class="sh-escaped-newline">\</span>
                <span class="variable-name">branch</span>=<span class="string">"$(cut -c1-7 "$base_dir/HEAD")..."</span>

        <span class="keyword">fi</span>
    <span class="keyword">fi</span>
    <span class="variable-name">dirty</span>=<span class="string">''</span>
    <span class="variable-name">branch</span>=${<span class="variable-name">branch</span>#refs/heads/}
    <span class="keyword">if</span> (<span class="negation-char">!</span> ((git diff --cached --quiet) &amp;&amp; (git diff --quiet))); <span class="keyword">then</span> 
        <span class="variable-name">dirty</span>=<span class="string">'yes'</span>
    <span class="keyword">else</span> 
        <span class="variable-name">dirty</span>=<span class="string">''</span>
    <span class="keyword">fi</span>
    <span class="variable-name">vcs</span>=<span class="string">"git"</span>
}

<span class="comment-delimiter"># </span><span class="comment">svn
</span><span class="function-name">__svn_dir</span>() {
    [[ -d <span class="string">".svn"</span> ]] || <span class="keyword">return</span> 1
    <span class="variable-name">base_dir</span>=<span class="string">"."</span>
    <span class="keyword">while</span> [[ -d <span class="string">"$base_dir/../.svn"</span> ]]; <span class="keyword">do</span> <span class="variable-name">base_dir</span>=<span class="string">"$base_dir/.."</span>; <span class="keyword">done</span>
    <span class="variable-name">base_dir</span>=$(readlink -f <span class="string">"$base_dir"</span>)
    <span class="variable-name">sub_dir</span>=$(__sub_dir <span class="string">"${base_dir}"</span>)
    <span class="variable-name">branch</span>=$(svn info <span class="string">"$base_dir"</span> | awk <span class="string">'/^URL/ { sub(".*/","",$0); r=$0 } /^Revision/ { sub("[^0-9]*","",$0); print r":"$0 }'</span>)
    <span class="variable-name">vcs</span>=<span class="string">"svn"</span>
}

<span class="comment-delimiter"># </span><span class="comment">svk
</span><span class="function-name">__svk_dir</span>() {
    [[ -f ~/.svk/config ]] || <span class="keyword">return</span> 1
    <span class="variable-name">base_dir</span>=$(awk <span class="string">'/: *$/ { sub(/^ */,"",$0); sub(/: *$/,"",$0); if (match("'</span>${<span class="variable-name">PWD</span>}<span class="string">'", $0"(/|$)")) { print $0; d=1; } } /depotpath/ &amp;&amp; d == 1 { sub(".*/","",$0); r=$0 } /revision/ &amp;&amp; d == 1 { print r ":" $2; exit 1 }'</span> ~/.svk/config) &amp;&amp; <span class="keyword">return</span> 1
    <span class="variable-name">branch</span>=${<span class="variable-name">base_dir</span>##*
    }
    <span class="variable-name">base_dir</span>=${<span class="variable-name">base_dir</span>%%
        *}
    <span class="variable-name">sub_dir</span>=$(__sub_dir <span class="string">"${base_dir}"</span>)
    <span class="variable-name">vcs</span>=<span class="string">"svk"</span>
}

<span class="comment-delimiter"># </span><span class="comment">mercurial
</span><span class="function-name">__hg_dir</span>() {
    
    <span class="variable-name">base_dir</span>=$(hg root 2&gt;/dev/null) || <span class="keyword">return</span> 1
    <span class="variable-name">base_dir</span>=$(readlink -f <span class="string">"$base_dir"</span>)
    <span class="variable-name">sub_dir</span>=$(__sub_dir <span class="string">"${base_dir}"</span>)
    <span class="comment-delimiter">#</span><span class="comment">branch=$(&lt; "${base_dir}/.hg/branch")
</span>    <span class="variable-name">branch</span>=<span class="string">"hg:$(hg branch)"</span>
    <span class="variable-name">vcs</span>=<span class="string">"hg"</span>
}
<span class="comment-delimiter"># </span><span class="comment">return formatted path components (prefix branch postfix) given the
</span><span class="comment-delimiter"># </span><span class="comment">repository root and the branch.
</span><span class="function-name">__vcs_get_prompt_path_components</span>()
{
  <span class="comment-delimiter"># </span><span class="comment">shortcut: if there are no arguments, return a default prompt
</span>  <span class="keyword">if</span> [ -z <span class="string">"${1:-}"</span> ]; <span class="keyword">then</span>
    <span class="variable-name">pwdnamed</span>=<span class="string">"%${_PROMPT_PATH_MAXLEN}&lt;..&lt;%~%&lt;&lt;"</span>
    <span class="variable-name">pwdnamed</span>=<span class="string">"${(%)pwdnamed}"</span>
    <span class="builtin">echo</span> <span class="string">"$pwdnamed"</span>
    <span class="keyword">return</span>
  <span class="keyword">fi</span>

  <span class="builtin">local</span> reporoot branch workdir
  <span class="variable-name">workdir</span>=<span class="string">''</span>
  <span class="variable-name">reporoot</span>=<span class="string">"${1%%/}"</span>
  <span class="variable-name">branch</span>=<span class="string">"$2"</span>

  <span class="comment-delimiter"># </span><span class="comment">replace named directories in the PWD, we need thi for the proper component
</span>  <span class="comment-delimiter"># </span><span class="comment">count later
</span>  <span class="builtin">local</span> <span class="variable-name">pwdnamed</span>=<span class="string">"%~"</span>
  <span class="variable-name">pwdnamed</span>=<span class="string">"${(%)pwdnamed}"</span>

  <span class="comment-delimiter"># </span><span class="comment">store paths in arrays for component count calculation
</span>  <span class="builtin">typeset</span> -la apwd apwdnamed areporoot
  <span class="variable-name">apwd</span>=(${(s:/:)PWD})
  <span class="variable-name">apwdnamed</span>=(${(s:/:)pwdnamed})
  <span class="variable-name">areporoot</span>=(${(s:/:)reporoot})

  <span class="comment-delimiter"># </span><span class="comment">get the number of leading and trailing path components. Since we're using
</span>  <span class="comment-delimiter"># </span><span class="comment">%~ later and then /home/madduck suddenly becomes ~, which is 1, not
</span>  <span class="comment-delimiter"># </span><span class="comment">2 components, we calculate the leading component count by using the named
</span>  <span class="comment-delimiter"># </span><span class="comment">path and the number of post components
</span>  <span class="builtin">local</span> precomps postcomps
  <span class="variable-name">postcomps</span>=$(($<span class="variable-name">#</span>apwd - $<span class="variable-name">#</span>areporoot))
  <span class="variable-name">precomps</span>=$(($<span class="variable-name">#</span>apwdnamed - $<span class="variable-name">postcomps</span>))

  <span class="builtin">local</span> postfix
  <span class="keyword">if</span> (( $<span class="variable-name">postcomps</span> &gt; 0 )); <span class="keyword">then</span>
    <span class="variable-name">postfix</span>=<span class="string">"%${postcomps}~"</span>
    <span class="variable-name">postfix</span>=<span class="string">"${(%)postfix}"</span>
  <span class="keyword">fi</span>
  
  <span class="comment-delimiter"># </span><span class="comment">we don't want the prompt to get too long, so keep the total prompt length
</span>  <span class="comment-delimiter"># </span><span class="comment">under $_PROMPT_PATH_MAXLEN (25), but ensure that the prefix is not shorter
</span>  <span class="comment-delimiter"># </span><span class="comment">than $_PROMPT_PATH_MINLEN (10), no matter what
</span>  <span class="builtin">local</span> prelen minlen prefix
  <span class="variable-name">prelen</span>=$((${<span class="variable-name">_PROMPT_PATH_MAXLEN</span>:-25} - $<span class="variable-name">#</span>branch - $<span class="variable-name">#</span>postfix))
  <span class="variable-name">minlen</span>=${<span class="variable-name">_PROMPT_PATH_MINLEN</span>:-10}
  (( $<span class="variable-name">prelen</span> &lt; $<span class="variable-name">minlen</span> )) &amp;&amp; <span class="variable-name">prelen</span>=$<span class="variable-name">minlen</span>
  <span class="variable-name">prefix</span>=<span class="string">"%${prelen}&lt;..&lt;%-${precomps}~%&lt;&lt;"</span>
  <span class="variable-name">prefix</span>=<span class="string">"${(%)prefix}"</span>

  <span class="builtin">echo</span> <span class="string">"$prefix"</span> <span class="string">"$branch"</span> <span class="string">"$postfix"</span>
}

<span class="comment-delimiter"># </span><span class="comment">set psvar[1..3] depending on repo type, or just psvar[1] if no repo found
</span><span class="function-name">__vcs_set_prompt_variables</span>()
{
    <span class="variable-name">workdir</span>=<span class="string">''</span>
    <span class="variable-name">vcs</span>=<span class="string">''</span>
    <span class="variable-name">dirty</span>=<span class="string">''</span>
    <span class="variable-name">psvar</span>=(<span class="string">"${(%)p}"</span>)

    __git_dir || __arch_dir || __svn_dir || __bzr_dir <span class="comment-delimiter">#</span><span class="comment">|| __svk_dir || __hg_dir 
</span>    <span class="keyword">if</span> [[ -z <span class="string">"$vcs"</span> ]]; <span class="keyword">then</span>
        <span class="builtin">local</span> <span class="variable-name">p</span>=<span class="string">"%${MAXLEN}&lt;..&lt;%~%&lt;&lt;"</span>
        <span class="variable-name">psvar</span>=(<span class="string">"${(%)p}"</span>)
        <span class="keyword">return</span>
    <span class="keyword">fi</span>
    <span class="builtin">set</span> -- $(__vcs_get_prompt_path_components <span class="string">"$base_dir"</span> <span class="string">"$branch"</span>)
    <span class="variable-name">psvar</span>[1]=<span class="string">"$1"</span>
    <span class="keyword">if</span> [[ -n <span class="string">"$vcs_op"</span> ]]; <span class="keyword">then</span>
        <span class="variable-name">psvar</span>[2]=<span class="string">"[$2::$vcs_op]"</span>
    <span class="keyword">else</span>
        <span class="variable-name">psvar</span>[2]=<span class="string">"[$2]"</span>
    <span class="keyword">fi</span>
    <span class="variable-name">psvar</span>[3]=<span class="string">"$3"</span>
    <span class="variable-name">psvar</span>[4]=$(<span class="builtin">print</span> -P <span class="string">"%n\\\@%m:"</span>)
    <span class="keyword">if</span> [[ -n <span class="string">"$dirty"</span> ]]; <span class="keyword">then</span>
        <span class="variable-name">psvar</span>[5]=<span class="string">"$dirty"</span>
    <span class="keyword">fi</span>
}

<span class="comment-delimiter"># </span><span class="comment">Set up the per-command and chpwd functions
</span><span class="keyword">if</span> [ $(id -u) <span class="negation-char">!</span>= 0 ]; <span class="keyword">then</span>
  <span class="comment-delimiter"># </span><span class="comment">too dangerous to be run as root
</span>
  _update_vcs_prompt_vars_if_vcs_ran() {
    <span class="keyword">case</span> <span class="string">"$(history $(($HISTCMD - 1)))"</span><span class="keyword"> in</span>
      <span class="comment-delimiter"># </span><span class="comment">$vcs appeared in last command, so be sure to update
</span>      *${<span class="variable-name">vcs</span>}*) __vcs_set_prompt_variables <span class="string">"$vcs"</span>
    <span class="keyword">esac</span>
  }
  <span class="variable-name">precmd_functions</span>+=(_update_vcs_prompt_vars_if_vcs_ran)

  _update_vcs_prompt_vars() {
    __vcs_set_prompt_variables
  }
  <span class="variable-name">chpwd_functions</span>+=(_update_vcs_prompt_vars)

  <span class="comment-delimiter"># </span><span class="comment">call it once
</span>  _update_vcs_prompt_vars
<span class="keyword">fi</span>

<span class="function-name">prompt_manoj_precmd</span> () {
    <span class="builtin">setopt</span> noxtrace localoptions

}

<span class="function-name">prompt_manoj_setup</span> () {
    <span class="variable-name">PS2</span>=<span class="string">"%_&gt; "</span>
    <span class="variable-name">PS3</span>=<span class="string">"?# "</span>
    <span class="variable-name">PS4</span>=<span class="string">"+%N:%i&gt; "</span>
    <span class="variable-name">RPS1</span>=<span class="string">'%~'</span>
    <span class="variable-name">RPS2</span>=<span class="string">'&lt;%^'</span>

    <span class="keyword">if</span>   [[ -d /proc/apm ]];  <span class="keyword">then</span>  battery_color () { prompt_manoj_apm_color        }      
    <span class="keyword">elif</span> [[ -d /proc/acpi ]]; <span class="keyword">then</span>  battery_color () { prompt_manoj_acpi_color       } 
    <span class="keyword">else</span>                            battery_color () { <span class="builtin">echo</span>  <span class="string">"$term_color_fg[green]"</span> }
    <span class="keyword">fi</span>

    <span class="comment-delimiter">## </span><span class="comment">set variable debian_chroot if running in a chroot with /etc/debian_chroot
</span>    <span class="comment-delimiter">#</span><span class="comment">if [[ -z "$debian_chroot" ]] &amp;&amp; [[ -r /etc/debian_chroot ]] ; then
</span>    <span class="comment-delimiter">#    </span><span class="comment">debian_chroot=$(cat /etc/debian_chroot)
</span>    <span class="comment-delimiter">#</span><span class="comment">fi
</span>
    <span class="keyword">if</span> [[ -n <span class="string">"$terminfo[rev]"</span>  ]]; <span class="keyword">then</span> <span class="variable-name">rev_vid</span>=<span class="string">"$terminfo[rev]"</span>;
    <span class="keyword">else</span>                                <span class="variable-name">rev_vid</span>=;                  <span class="keyword">fi</span>
    <span class="keyword">if</span> [[ -n <span class="string">"$terminfo[dim]"</span>  ]]; <span class="keyword">then</span> <span class="variable-name">rev_vid</span>=<span class="string">"$terminfo[dim]"</span>;
    <span class="keyword">else</span>                                <span class="variable-name">rev_vid</span>=;                  <span class="keyword">fi</span>
    <span class="keyword">if</span> [[ -n <span class="string">"$terminfo[sgr0]"</span> ]]; <span class="keyword">then</span> <span class="variable-name">norm_vid</span>=<span class="string">"$terminfo[sgr0]"</span>;
    <span class="keyword">else</span>                                <span class="variable-name">norm_vid</span>=;                 <span class="keyword">fi</span>

    <span class="keyword">case</span> $<span class="variable-name">TERM</span><span class="keyword"> in</span>
        emacs|dumb)
            <span class="variable-name">PS1</span>=<span class="string">"%(!,#,_)_&gt; "</span>
            ;;
        *xterm*|rxvt|screen|sun-cmd|(dt|k|E)term)
            <span class="variable-name">PS1</span>=<span class="string">"%(5v,%{$term_color_fg[magenta]%},)%(2v.%B%2v%b.)%{$dim_vid$(battery_color)%}%(?,_,%?)%(!,#,_)&gt;%{$norm_vid%} "</span>
            <span class="variable-name">RPS1</span>=<span class="string">"%{$dim_vid$(battery_color)%}%40&lt;...&lt;%~%{$reset_color%}"</span>
            ;;
        *)
            <span class="variable-name">PS1</span>=<span class="string">"%(5v,%{$term_color_fg[magenta]%},)%(2v.%B%2v%b.)%u%{$dim_vid$(battery_color)%}%(?,_,%?)%(!,#,_)&gt;%{$norm_vid%} "</span>
            <span class="variable-name">RPS1</span>=<span class="string">"%{$dim_vid$(battery_color)%}%40&lt;...&lt;%~%{$reset_color%}"</span>
    <span class="keyword">esac</span>
    <span class="comment-delimiter">#</span><span class="comment">PS1="%{%S%}${workdir}%s%{$dim_vid%}$PROMPTCOMMENT%{$norm_vid%} %{$(battery_color)%}%(!,#,_)_&gt;%{$norm_vid%} "
</span>
    <span class="comment-delimiter"># </span><span class="comment">space_left=$(( $COLUMNS - $#base_prompt_expanded_no_color - 2 ))
</span>
    precmd  () { }
    preexec () { }
    chpwd   () { prompt_manoj_chpwd }
}

prompt_manoj_setup <span class="string">"$@"</span>
</pre>
  </body>
</html>
